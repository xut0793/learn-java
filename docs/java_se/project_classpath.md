# 类路径 Classpath

从 Java 源代码到运行的程序，会有编译和链接两个步骤。

1. 编译是将源代码文件变成扩展名是`.class`的一种字节码文件，这个工作一般是由`javac`命令调用编译器完成的。它将根据类引用的依赖关系，递归地编译所有引用到的类，确保所有类都被编译成字节码文件。
2. 链接是在运行时动态执行的，`.class` 文件不能直接运行，通过 `java` 命令调用 Java 虚拟机（JVM），去解析`.class` 字节码文件，将它转换为机器能识别的二进制代码，然后运行。简单说，所谓链接就是根据引用到的类加载相应的字节码文件并执行。

在 Java 源代码编译时，Java 编译器会确定引用的每个类的完全限定名，确定的方式是根据`import`语句和`classpath`。如果导入的是完全限定类名，则可以直接比较并确定。如果是模糊导入（import 带．\*）​，则根据`classpath`找对应父包，再在父包下寻找是否有对应的类。如果多个模糊导入的包下都有同样的类名，则 Java 会提示编译错误，此时应该明确指定导入哪个类。

Java 运行时，会根据编译时已经确定的类的完全限定名来寻找并加载类，寻找的方式就是在类路径 classpath 中寻找，如果是`.class`文件的根目录，则直接查看是否有对应的子目录及文件，如果是`.jar` 文件，则首先在内存中解压文件，然后再查看是否有对应的类。

所以不管是 Java 编译和运行，都需要指定一个类路径 classpath 来查找依赖的类文件。

如果用命令行编译或运行程序，可以通过 `-classpath` 或 `-cp` 选项来指定类路径。例如：

```bash
# 编译时指定类路径
javac -classpath /path/to/classes MyClass.java
# 运行时指定类路径
java -classpath /path/to/classes MyClass
```

## 全局变量 classpath

类路径 classpath 也可以通过环境变量 `CLASSPATH` 来全局指定。在 Windows 系统中，多个路径用分号“; ”分隔；在其他系统中，以冒号“:”分隔。单独的 `.` 点号表示当前目录。

类路径的查找规则：

1. 如果指定了 `-classpath` 或 `-cp` 选项，则使用指定的类路径。
2. 如果没有指定 `-classpath` 或 `-cp` 选项，则使用 `CLASSPATH` 环境变量指定的类路径。
3. 如果 `CLASSPATH` 环境变量没有指定类路径，则默认使用当前目录（`.`）。

## 总结

- 类路径（Classpath）指定了编译器和虚拟机应该去哪里查找类文件，
- `import`是编译时概念，用于确定完全限定名，在运行时，只根据完全限定名寻找并加载类。

> java 的 classpath 有点类似 JavaScript 语言项目中的 `node_modules` 目录，用于存放项目依赖的类库。只是在 JS 项目中 `node_modules` 是固定目录名称，默认会在项目根目录下查找 `node_modules` 目录。而在 Java 项目中，存放依赖的文件目录不固定，可以通过指定类路径 classpath 来自定义，但是默认是当前目录（`.`）。
